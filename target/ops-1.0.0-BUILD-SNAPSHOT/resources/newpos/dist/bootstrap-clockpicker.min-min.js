/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
!function(){function D(a){return document.createElementNS(H,a)}function O(a){return(10>a?"0":"")+a}function S(b){var a=++K+"";return b?b+a:a}function E(V,ab){function ad(an,aj){var al=A.offset(),ao=/^touch/.test(an.type),u=al.left+W,Y=al.top+W,r=(ao?an.originalEvent.touches[0]:an).pageX-u,ak=(ao?an.originalEvent.touches[0]:an).pageY-Y,ai=Math.sqrt(r*r+ak*ak),am=!1;if(!aj||!(Q-x>ai||ai>Q+x)){an.preventDefault();var ah=setTimeout(function(){U.addClass("clockpicker-moving")},200);L&&A.append(t.canvas),t.setHand(r,ak,!aj,!0),X.off(T).on(T,function(m){m.preventDefault();var h=/^touch/.test(m.type),v=(h?m.originalEvent.touches[0]:m).pageX-u,p=(h?m.originalEvent.touches[0]:m).pageY-Y;(am||v!==r||p!==ak)&&(am=!0,t.setHand(v,p,!1,!0))}),X.off(R).on(R,function(m){X.off(R),m.preventDefault();var v=/^touch/.test(m.type),p=(v?m.originalEvent.changedTouches[0]:m).pageX-u,h=(v?m.originalEvent.changedTouches[0]:m).pageY-Y;(aj||am)&&p===r&&h===ak&&t.setHand(p,h),"hours"===t.currentView?t.toggleView("minutes",G/2):ab.autoclose&&(t.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){t.done()},G/2)),A.prepend(af),clearTimeout(ah),U.removeClass("clockpicker-moving"),X.off(T)})}}var ag=J(j),A=ag.find(".clockpicker-plate"),y=ag.find(".clockpicker-hours"),ae=ag.find(".clockpicker-minutes"),e=ag.find(".clockpicker-am-pm-block"),aa="INPUT"===V.prop("tagName"),w=aa?V:V.find("input"),g=V.find(".input-group-addon"),t=this;if(this.id=S("cp"),this.element=V,this.options=ab,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=aa,this.input=w,this.addon=g,this.popover=ag,this.plate=A,this.hoursView=y,this.minutesView=ae,this.amPmBlock=e,this.spanHours=ag.find(".clockpicker-span-hours"),this.spanMinutes=ag.find(".clockpicker-span-minutes"),this.spanAmPm=ag.find(".clockpicker-span-am-pm"),this.amOrPm="PM",ab.twelvehour){var f=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");J(f);J('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){t.amOrPm="AM",J(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),J('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){t.amOrPm="PM",J(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}ab.autoclose||J('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+ab.donetext+"</button>").click(J.proxy(this.done,this)).appendTo(ag),"top"!==ab.placement&&"bottom"!==ab.placement||"top"!==ab.align&&"bottom"!==ab.align||(ab.align="left"),"left"!==ab.placement&&"right"!==ab.placement||"left"!==ab.align&&"right"!==ab.align||(ab.align="top"),ag.addClass(ab.placement),ag.addClass("clockpicker-align-"+ab.align),this.spanHours.click(J.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(J.proxy(this.toggleView,this,"minutes")),w.on("focus.clockpicker click.clockpicker",J.proxy(this.show,this)),g.on("click.clockpicker",J.proxy(this.toggle,this));var M,Z,o,ac,n=J('<div class="clockpicker-tick"></div>');if(ab.twelvehour){for(M=1;13>M;M+=1){Z=n.clone(),o=M/6*Math.PI,ac=Q,Z.css("font-size","120%"),Z.css({left:W+Math.sin(o)*ac-x,top:W-Math.cos(o)*ac-x}),Z.html(0===M?"00":M),y.append(Z),Z.on(N,ad)}}else{for(M=0;24>M;M+=1){Z=n.clone(),o=M/6*Math.PI;var i=M>0&&13>M;ac=i?z:Q,Z.css({left:W+Math.sin(o)*ac-x,top:W-Math.cos(o)*ac-x}),i&&Z.css("font-size","120%"),Z.html(0===M?"00":M),y.append(Z),Z.on(N,ad)}}for(M=0;60>M;M+=5){Z=n.clone(),o=M/30*Math.PI,Z.css({left:W+Math.sin(o)*Q-x,top:W-Math.cos(o)*Q-x}),Z.css("font-size","120%"),Z.html(O(M)),ae.append(Z),Z.on(N,ad)}if(A.on(N,function(h){0===J(h.target).closest(".clockpicker-tick").length&&ad(h,!0)}),L){var af=ag.find(".clockpicker-canvas"),l=D("svg");l.setAttribute("class","clockpicker-svg"),l.setAttribute("width",q),l.setAttribute("height",q);var d=D("g");d.setAttribute("transform","translate("+W+","+W+")");var c=D("circle");c.setAttribute("class","clockpicker-canvas-bearing"),c.setAttribute("cx",0),c.setAttribute("cy",0),c.setAttribute("r",2);var k=D("line");k.setAttribute("x1",0),k.setAttribute("y1",0);var b=D("circle");b.setAttribute("class","clockpicker-canvas-bg"),b.setAttribute("r",x);var a=D("circle");a.setAttribute("class","clockpicker-canvas-fg"),a.setAttribute("r",3.5),d.appendChild(k),d.appendChild(b),d.appendChild(a),d.appendChild(c),l.appendChild(d),af.append(l),this.hand=k,this.bg=b,this.fg=a,this.bearing=c,this.g=d,this.canvas=af}I(this.options.init)}function I(a){a&&"function"==typeof a&&a()}var U,J=window.jQuery,F=J(window),X=J(document),H="http://www.w3.org/2000/svg",L="SVGAngle" in window&&function(){var b,a=document.createElement("div");return a.innerHTML="<svg/>",b=(a.firstChild&&a.firstChild.namespaceURI)==H,a.innerHTML="",b}(),P=function(){var a=document.createElement("div").style;return"transition" in a||"WebkitTransition" in a||"MozTransition" in a||"msTransition" in a||"OTransition" in a}(),C="ontouchstart" in window,N="mousedown"+(C?" touchstart":""),T="mousemove.clockpicker"+(C?" touchmove.clockpicker":""),R="mouseup.clockpicker"+(C?" touchend.clockpicker":""),B=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,K=0,W=100,Q=80,z=54,x=13,q=2*W,G=P?350:1,j=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");E.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},E.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},E.prototype.locate=function(){var b=this.element,a=this.popover,g=b.offset(),d=b.outerWidth(),h=b.outerHeight(),l=this.options.placement,k=this.options.align,f={};switch(a.show(),l){case"bottom":f.top=g.top+h;break;case"right":f.left=g.left+d;break;case"top":f.top=g.top-a.outerHeight();break;case"left":f.left=g.left-a.outerWidth()}switch(k){case"left":f.left=g.left;break;case"right":f.left=g.left+d-a.outerWidth();break;case"top":f.top=g.top;break;case"bottom":f.top=g.top+h-a.outerHeight()}a.css(f)},E.prototype.show=function(){if(!this.isShown){I(this.options.beforeShow);var a=this;this.isAppended||(U=J(document.body).append(this.popover),F.on("resize.clockpicker"+this.id,function(){a.isShown&&a.locate()}),this.isAppended=!0);var c=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===c[0]){var b=new Date(+new Date+this.options.fromnow);c=[b.getHours(),b.getMinutes()]}this.hours=+c[0]||0,this.minutes=+c[1]||0,this.spanHours.html(O(this.hours)),this.spanMinutes.html(O(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,X.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(d){var f=J(d.target);0===f.closest(a.popover).length&&0===f.closest(a.addon).length&&0===f.closest(a.input).length&&a.hide()}),X.on("keyup.clockpicker."+this.id,function(d){27===d.keyCode&&a.hide()}),I(this.options.afterShow)}},E.prototype.hide=function(){I(this.options.beforeHide),this.isShown=!1,X.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),X.off("keyup.clockpicker."+this.id),this.popover.hide(),I(this.options.afterHide)},E.prototype.toggleView=function(b,a){var g=!1;"minutes"===b&&"visible"===J(this.hoursView).css("visibility")&&(I(this.options.beforeHourSelect),g=!0);var d="hours"===b,h=d?this.hoursView:this.minutesView,f=d?this.minutesView:this.hoursView;this.currentView=b,this.spanHours.toggleClass("text-primary",d),this.spanMinutes.toggleClass("text-primary",!d),f.addClass("clockpicker-dial-out"),h.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(a),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){f.css("visibility","hidden")},G),g&&I(this.options.afterHourSelect)},E.prototype.resetClock=function(u){var h=this.currentView,k=this[h],v="hours"===h,f=Math.PI/(v?6:30),l=k*f,g=v&&k>0&&13>k?z:Q,b=Math.sin(l)*g,m=-Math.cos(l)*g,d=this;L&&u?(d.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){d.canvas.removeClass("clockpicker-canvas-out"),d.setHand(b,m)},u)):this.setHand(b,m)},E.prototype.setHand=function(Z,y,aa,i){var M,b=Math.atan2(Z,-y),V="hours"===this.currentView,g=Math.PI/(V||aa?6:30),v=Math.sqrt(Z*Z+y*y),Y=this.options,n=V&&(Q+z)/2>v,A=n?z:Q;if(Y.twelvehour&&(A=Q),0>b&&(b=2*Math.PI+b),M=Math.round(b/g),b=M*g,Y.twelvehour?V?0===M&&(M=12):(aa&&(M*=5),60===M&&(M=0)):V?(12===M&&(M=0),M=n?0===M?12:M:0===M?0:M+12):(aa&&(M*=5),60===M&&(M=0)),this[this.currentView]!==M&&B&&this.options.vibrate&&(this.vibrateTimer||(navigator[B](10),this.vibrateTimer=setTimeout(J.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=M,this[V?"spanHours":"spanMinutes"].html(O(M)),!L){return void this[V?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var a=J(this);a.toggleClass("active",M===+a.html())})}i||!V&&M%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var w=Math.sin(b)*A,l=-Math.cos(b)*A;this.hand.setAttribute("x2",w),this.hand.setAttribute("y2",l),this.bg.setAttribute("cx",w),this.bg.setAttribute("cy",l),this.fg.setAttribute("cx",w),this.fg.setAttribute("cy",l)},E.prototype.done=function(){I(this.options.beforeDone),this.hide();var a=this.input.prop("value"),b=O(this.hours)+":"+O(this.minutes);this.options.twelvehour&&(b+=this.amOrPm),this.input.prop("value",b),b!==a&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),I(this.options.afterDone)},E.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(F.off("resize.clockpicker"+this.id),this.popover.remove())},J.fn.clockpicker=function(b){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=J(this),f=d.data("clockpicker");if(f){"function"==typeof f[b]&&f[b].apply(f,a)}else{var g=J.extend({},E.DEFAULTS,d.data(),"object"==typeof b&&b);d.data("clockpicker",new E(d,g))}})}}();